---
title: "Irish Hospital Waiting List November 2017"
author: "Azmir Fakkri"
date: "13/4/2018"
output: 
  html_document:
    keep_md: true
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r}
#install and load packages
library(dplyr)
library(stringr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(grid)
library(knitr)
library(kableExtra)

# Load data
wl_raw <- read.csv("https://raw.githubusercontent.com/azmirfakkri/datascience-projects/master/Datasets/IPDC%20Waiting%20List%20By%20Group%20Hospital%202017.csv", 
                     header = TRUE, sep = ",")

# View the whole data structure
glimpse(wl_raw)
```

```{r}
# Check for missing values
any(is.na(wl_raw))
```

```{r}
# View head
kable(head(wl_raw), "html", caption = "Irish Hospital Waiting List 2017") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

# Data Analysis

As November is the most recent snapshot of the waiting list in Irish public hospitals, a subset of the data is created and analyses will be focused on that particular month.

```{r, fig.align='center'}
# November Cases
wl_nov <- wl_raw %>% filter(Archive.Date == "2017-11-30")

# Plot 1: Total Cases by Hospital Group in Nov 2017
wl_nov %>% group_by(Group, Hospital) %>%
  summarise(Total_Cases = sum(Total)) %>%
ggplot(aes(x = Group, y = Total_Cases, fill = Group)) + 
  geom_bar(stat = "identity") +
  labs(title = "Total Cases by Hospital Group in Nov 2017",
       y = "Total Cases") +
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank())
```

From the bar chart, it can be seen that there are seven hospital groups in Ireland. Every hospital group is associated with a few hospitals in Ireland. Saolta University Health Care Group recorded the highest number of patients in the waiting list.  

In November 2017, the total number of patients in the waiting list is 80595. This is an interesting point as a number of major Irish newspapers are quoting a much higher number in, 687000 (RTE, August 2017) and 680000 (Irish Times, October 2017). From a quick research, the data used by Irish Times and RTE are also sourced from NTPF.

```{r}
# Hospitals by Group
hosp_group <- wl_nov %>% group_by(Group, Hospital) %>%
  summarise(Total_Cases = sum(Total))

kable(hosp_group, "html", caption = "Hospital Group and Total Cases") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

All hospitals associated with each group can be seen in the table above along with the total number of patients in the waiting list for November 2017.

```{r, fig.height=8, fig.width=10, fig.align='left'}
# Total Cases by Hospital in Nov 2017
wl_nov %>% group_by(Group, Hospital) %>%
  summarise(Total_Cases = sum(Total)) %>%
ggplot(aes(x = reorder(Hospital, Total_Cases),
                          y = Total_Cases,
                          fill = Total_Cases)) +
  geom_bar(stat = "identity") +
  labs(title = "Total Cases by Hospital in Nov 2017",
       x = "Hospital",
       y = "Total Cases") +
  scale_fill_continuous(guide = "none", low ="blue", high ="red") +
  coord_flip()
```

Galway University Hospital has the highest number of patients in the waiting list in November 2017.  
Five of the top 10 hospitals with highest number of waiting list cases are located in Dublin, including Beaumont Hospital, Mater Misericordiae University Hospital, St. James’s Hospital, Tallaght Hospital and Our Lady’s Children Hospital Crumlin.

```{r, fig.height=6, fig.width=4}
# Total Cases by Patient Type and Case Type
wl_nov %>% group_by(Adult.Child, Case.Type) %>%
  summarise(Total_Cases = sum(Total)) %>%
  ggplot(aes(x = Adult.Child, y = Total_Cases, fill = Case.Type)) +
  geom_bar(stat = "identity") +
  labs(title = "Cases by Patient Type and Case Type",
       x = "Patient Type",
       y = "Total Cases") +
  geom_text(aes(label = Total_Cases), position = position_stack(vjust = 0.5),
            colour = "white", size = 3) +
  scale_fill_discrete(name = "Case Type") +
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank())
```

The number of adult patients in the waiting list are almost 10 times higher than child patients. In both group of patients, the number of day case is higher than inpatient case.

```{r, fig.height=7, fig.width=4}
# Total Cases by Case Type and Age Profile
wl_nov %>% group_by(Case.Type, Age.Profile) %>%
  summarise(Total_Cases = sum(Total)) %>%
ggplot(aes(x = Case.Type, y = Total_Cases, fill = Age.Profile)) +
  geom_bar(stat = "identity") +
  labs(title = "Cases by Case Type and Age Profile",
       x = "Case Type",
       y = "Total Cases") +
  geom_text(aes(label = Total_Cases), position = position_stack(vjust = 0.5),
            colour = "white", size = 3) +
  scale_fill_discrete(name = "Age Profile") +
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank())
```

In general, day case has more patients in the waiting list compared to inpatient case. There is a higher number of patients aged between 16 to 64 years old in the waiting list for both categories compared to the rest of the age profiles.

```{r}
# Total Cases by Month by Hospital Group
total_bydate <- wl_raw %>% group_by(Archive.Date, Group) %>%
  summarise(Average_Cases = mean(Total))

total_bydate2 <- separate(total_bydate, "Archive.Date", c("Year", "Month", "Day"), sep = "-")
total_bymonth <- total_bydate2[ , c(-1, -3)]

# Plot 5: Monthly Average Cases by Hospital Group
ggplot(total_bymonth, aes(x = Month, y = Average_Cases, colour = Group, group = Group)) + 
  geom_point() +
  geom_line() +
  labs(title = "Monthly Average Cases by Hospital Group",
       y = "Average Cases")
```

From January to November 2017, only a minimal reduction in the average number of patients in the waiting list across all hospital groups can be seen except for RCSI Hospitals Group.

```{r, fig.height=9, fig.width=13, fig.align='center'}
# Total Cases by Speciality based on Case Type in Nov 2017
wl_nov %>% group_by(Speciality, Case.Type) %>%
  summarise(Total_Cases = sum(Total)) %>%
ggplot(aes(x = reorder(Speciality, -Total_Cases),
                          y = Total_Cases,
                          fill = Case.Type)) +
  geom_bar(stat = "identity") +
  labs(title = "Total Cases by Speciality based on Case Type in Nov 2017",
       x = "Speciality",
       y = "Total Cases") +
  scale_fill_discrete(name = "Case Type") +
  theme(axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(angle = 90, hjust = 1))
```

The top five specialties with the most patients in the waiting list are led by Orthopaedics, followed by Ophthalmology, Urology, General Surgery and Otolaryngology (ENT).  
Orthopaedics has an almost balanced number of day case and inpatient case, however, Ophthalmology has a lot of day case patients compared to inpatient case in the waiting list.

```{r, fig.height=9}
# Total Cases by Time Bands based on Patient Type in Nov 2017
wl_nov %>% group_by(Time.Bands, Adult.Child) %>%
  summarise(Total_Cases = sum(Total)) %>%
ggplot(aes(Time.Bands, Total_Cases, fill = Adult.Child)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = Total_Cases),size = 3, position = position_dodge(0.9),
            vjust = 1.1, color = "white") +
  labs(title = "Total Cases by Time Bands based on Patient Type in Nov 2017",
       x = "Time Bands",
       y = "Total Cases") +
  scale_fill_discrete(name = "Patient Type") +
  theme(axis.ticks.y = element_blank(),
        axis.text.y = element_blank())
```

Time bands are the range of times (in months) for patients to be seen in Irish public hospitals. There is a lot of adult patients in all time bands compared to child patients. Looking at Figure 9, 0 to 3 months has the highest number of patients and 15 to 18 months has the least number of patients.  

There are less number of patients as waiting time (time bands) gets longer, but there is a slight increase in total cases for time band 18+ months. It could be inferred from Figure 24 that all hospitals are trying to see as many patients in the waiting list as soon as possible.  

A patient in the time band of 0 to 3 month are scheduled to be seen within 3 months from November 2017. It is also important to note that when a patient is being put in a waiting list, many aspects have been considered especially the severity of the disease. As an example, a patient with hyperkalaemia will always be seen and treated immediately.

```{r, fig.height=7}
# Total Cases by Time Bands based on Case Type in Nov 2017
wl_nov %>% group_by(Time.Bands, Case.Type) %>%
  summarise(Total_Cases = sum(Total)) %>%
  ggplot(aes(Time.Bands, Total_Cases, fill = Case.Type)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = Total_Cases), size = 3, position = position_dodge(0.9),
            vjust = 1.1, color = "white") +
  labs(title = "Total Cases by Time Bands based on Case Type in Nov 2017",
       x = "Time Bands",
       y = "Total Cases") +
  scale_fill_discrete(name = "Case Type") +
  theme(axis.ticks.y = element_blank(),
        axis.text.y = element_blank())
```

From the figure above, it can be seen that across all time bands, there is a lot more patient with day case than inpatient case in the waiting list.

# Recommendations

From this series of analyses, it is obvious that a big portion of cases in the waiting list are day cases. Strategies should be developed to allow patients to be seen quicker. More resources should be allocated to alleviate this problem.  

The top five hospitals with the highest number of patients in the waiting list are Galway University Hospital, Beaumont Hospital, Mater Misericordiae University Hospital, University Hospital Waterford and St. James’s Hospital.  

Based on specialties, the top five specialties with the highest number of patients in the waiting list are Orthopaedics, Ophthalmology, Urology, General Surgery and Otolaryngology (ENT). These hospitals and specialties will need special attention to deal with their waiting list. Further data and analysis are required to determine the factors causing this backlog in these specialties.

# Conclusion

The data analyses has provided some valuable information regarding the waiting list in Ireland. Most cases in the waiting list are day cases and the top five hospitals and specialties with the highest number of patients in the waiting list are now recognised and recommendations are made accordingly. Regarding the figures used in Irish Times and RTE, a small conclusion can be made that the numbers are misleading due to the way aggregated data were processed.